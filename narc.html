
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Narcwatch Pro</title>
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AkEEi4X6B8S3gAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABWUlEQVQ4y2NgGAXDFmzatMmKAQ34////Nvj////2////2/////+2////O////78dHBx8GRgY/gMrYGRkZPyPzICNGzeyMDExHQPKbQLi/0D8H4j/gfBOZmZmexADGAcHB38GqmQEZ8HmzZtVmZiYzgPF5YHi/0H8/0B+ARMQUwExM1DtC2AmMQLpS0Dx/0Dx/0D8A4gPATELUG4/kA/UDxRnBIn/B4r/AdK/QBgk9xeo9h5QzRIQPwWq/Q/Ef4D4KxD/BIn/AuJfQHwSiOWAgvsB4kfgwIF4PjCQdgPV/wRGCVAGOjBBWQYUvwfMxN1Q9f+AYv9B6n4D8X8oFwL5IGs+g1wLFIe4FuQbkJpgGH4g/Q8q+B+K4fQDxYAG/Aeq/Q3E0CwE6gU58isQ/wRiYCACcxEY3kCMAWB2/gLiLyA+kPYFMgSAhvoC6c9Q9f+B/B9QDMIoBv4Hqv0KxSA+SP4/kP4FNUQAGFZAMgEIzwFKAAAAAElFTkSuQmCC">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes trustedPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Light and Dark Mode */
    body {
      font-family: 'Poppins', sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.light-mode {
      background: linear-gradient(-45deg, #f0fdf4, #dcfce7, #f0fdf4);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: #1f2937;
    }
    body.dark-mode {
      background: linear-gradient(-45deg, #1f2937, #374151, #1f2937);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: #f3f4f6;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    .dark-mode .glass-card {
      background: rgba(31, 41, 55, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .progress-ring__circle {
      transition: stroke-dashoffset 0.8s cubic-bezier(0.33, 1, 0.68, 1);
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }
    .keyword-badge {
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .keyword-badge:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .glow {
      box-shadow: 0 0 15px rgba(22, 163, 74, 0.3);
    }
    .glow:hover {
      box-shadow: 0 0 25px rgba(22, 163, 74, 0.4);
    }
    .gradient-text {
      background: linear-gradient(90deg, #16a34a, #22c55e, #4ade80);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      background-size: 300% 300%;
      animation: gradient 8s ease infinite;
    }
    .dark-mode .gradient-text {
      background: linear-gradient(90deg, #34d399, #6ee7b7, #a7f3d0);
    }
    .fixed-chart-container {
      height: 400px !important;
      width: 100%;
      max-height: 400px !important;
    }
    .chart-bar {
      transition: height 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    .input-glow:focus {
      box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.3);
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    .info-card {
      transition: all 0.3s ease;
    }
    .info-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }
    .copy-btn {
      transition: all 0.2s ease;
    }
    .copy-btn:hover {
      background-color: rgba(0,0,0,0.05);
    }
    .copy-btn:active {
      transform: scale(0.95);
    }
    .keyword-scroll::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .keyword-scroll::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .keyword-scroll::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    .keyword-scroll::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    @media (max-width: 768px) {
      .mobile-stack {
        flex-direction: column !important;
      }
      .mobile-full-width {
        width: 100% !important;
      }
      .mobile-text-center {
        text-align: center !important;
      }
      .mobile-p-3 {
        padding: 0.75rem !important;
      }
      .mobile-mt-2 {
        margin-top: 0.5rem !important;
      }
      .mobile-mb-4 {
        margin-bottom: 1rem !important;
      }
      .term-chart-container {
        height: 500px !important;
      }
      .info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="min-h-screen light-mode">
  <!-- Dark Mode Toggle -->
  <div class="fixed top-4 right-4 z-50">
    <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
      <i class="fas fa-moon"></i>
    </button>
  </div>

  <!-- Floating particles background -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 left-1/4 w-4 h-4 bg-green-300 dark:bg-green-700 rounded-full opacity-30 float-animation" style="animation-delay: 0s;"></div>
    <div class="absolute top-1/3 right-1/4 w-3 h-3 bg-emerald-300 dark:bg-emerald-700 rounded-full opacity-30 float-animation" style="animation-delay: 0.5s;"></div>
    <div class="absolute bottom-1/4 left-1/3 w-5 h-5 bg-lime-300 dark:bg-lime-700 rounded-full opacity-30 float-animation" style="animation-delay: 1s;"></div>
    <div class="absolute bottom-1/3 right-1/3 w-2 h-2 bg-teal-300 dark:bg-teal-700 rounded-full opacity-30 float-animation" style="animation-delay: 1.5s;"></div>
  </div>

  <div class="container mx-auto px-4 py-8 md:py-12 max-w-7xl relative z-10">
    <!-- Header with animated gradient -->
    <div class="text-center mb-6 md:mb-8 slide-in" style="animation-delay: 0.2s;">
      <div class="inline-block p-2 md:p-3 rounded-xl  backdrop-blur-sm shadow-md mb-3">
        <i class="fas fa-shield-alt text-3xl md:text-4xl "></i>
      </div>
      <h1 class="text-2xl md:text-3xl font-bold mb-1">Narcwatch</h1>
      <p class="text-sm text-gray-500 dark:text-gray-400 md:text-base">Advanced drug content detection with trusted domain verification</p>
    </div>

    <!-- Main Card -->
    <div class="glass-card overflow-hidden shadow-lg slide-in" style="animation-delay: 0.4s;">
      <!-- Green header -->
      <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-4 md:p-5 text-white relative overflow-hidden">
        <div class="mb-2 md:mb-0 mobile-text-center">
            <h2 class="text-lg md:text-xl font-bold"><i class="fas fa-search mr-2"></i>Advanced Website Intelligence Scan</h2>
            <p class="text-green-100 mt-1 text-xs md:text-sm">Identifies drug-related content with 350+ terms and whitelist verification</p>
          </div>
        <div class="relative z-10 flex flex-col md:flex-row items-center justify-between">
          <div class="absolute inset-0 opacity-20">
          <div class="absolute top-0 right-0 w-32 h-32 bg-white rounded-full filter blur-3xl opacity-30"></div>
          <div class="absolute bottom-0 left-0 w-64 h-64 bg-green-300 rounded-full filter blur-3xl opacity-20"></div>
        </div>
          <div class="bg-white/20 p-2 rounded-full shadow-sm backdrop-blur-sm">
            <i class="fas fa-lock text-base md:text-lg"></i>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="p-4 md:p-5">
        <form id="checkForm" class="mb-5 fade-in" style="animation-delay: 0.6s;">
          <div class="flex mobile-stack">
            <input 
              type="text" 
              id="urlInput"
              placeholder="https://example.com"
              class="flex-grow px-4 py-3 md:py-3 border-0 rounded-l-lg md:rounded-r-none focus:ring-2 focus:ring-green-400 focus:outline-none input-glow text-gray-700 dark:text-gray-200 dark:bg-gray-700 mobile-full-width mobile-mb-2"
              required
            >
            <button
              type="submit"
              class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-5 py-3 md:px-6 md:py-3 rounded-r-lg md:rounded-l-none transition-all duration-300 flex items-center justify-center mobile-full-width glow"
            >
              <i class="fas fa-search mr-2"></i> Analyze
            </button>
          </div>
          <p class="text-gray-500 dark:text-gray-400 text-xs mt-2 mobile-text-center">
            <i class="fas fa-info-circle text-green-400 mr-1"></i> Scans for drug-related terms and comprehensive website metadata
          </p>
        </form>

        <!-- Results Section -->
        <div id="result" class="min-h-48 rounded-lg overflow-hidden">
          <div class="text-center py-8 md:py-10" id="defaultMessage">
            <div class="inline-block p-3 bg-green-50 dark:bg-green-900 rounded-full mb-3">
              <i class="fas fa-globe text-2xl text-green-500 dark:text-green-400"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-200 mb-1">Enter a URL to begin analysis</h3>
            <p class="text-gray-500 dark:text-gray-400 text-sm max-w-md mx-auto">Our system will scan the website content and fetch comprehensive metadata.</p>
          </div>
        </div>

        <!-- Historical Scans -->
        <div id="historySection" class="mt-6 hidden">
          <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-4 flex items-center">
            <i class="fas fa-history text-green-500 mr-2"></i> Previous Scans
          </h3>
          <div id="historyList" class="space-y-3"></div>
        </div>
      </div>
    </div>

    <!-- Simple Footer -->
    <div class="text-center mt-8 text-gray-500 dark:text-gray-400 text-xs fade-in" style="animation-delay: 1.4s;">
      <p>Developed by <span class="text-green-600 dark:text-green-400 font-medium">Ritik</span></p>
    </div>
  </div>

  <script>
    // Expanded Whitelist of trusted domains (case insensitive)
    const trustedDomains = [
      'google.com', 'www.google.com', 'google.co.in', 'www.google.co.in',
      'wikipedia.org', 'www.wikipedia.org', 'wikimedia.org', 'www.wikimedia.org',
      'microsoft.com', 'apple.com', 'amazon.com', 'youtube.com', 'www.youtube.com',
      'instagram.com', 'www.instagram.com', 'whatsapp.com', 'www.whatsapp.com',
      'amazon.in', 'www.amazon.in', 'cricbuzz.com', 'www.cricbuzz.com',
      'flipkart.com', 'www.flipkart.com', 'linkedin.com', 'www.linkedin.com',
      'hotstar.com', 'www.hotstar.com', 'disneyplus.com', 'www.disneyplus.com',
      'khanacademy.org', 'www.khanacademy.org', 'coursera.org', 'www.coursera.org',
      'edx.org', 'www.edx.org', 'twitter.com', 'www.twitter.com',
      'facebook.com', 'www.facebook.com', 'reddit.com', 'www.reddit.com',
      'netflix.com', 'www.netflix.com', 'spotify.com', 'www.spotify.com',
      'github.com', 'www.github.com', 'stackoverflow.com', 'www.stackoverflow.com',
      'medium.com', 'www.medium.com', 'quora.com', 'www.quora.com',
      'bbc.com', 'www.bbc.com', 'cnn.com', 'www.cnn.com',
      'nytimes.com', 'www.nytimes.com', 'wsj.com', 'www.wsj.com',
      'bloomberg.com', 'www.bloomberg.com', 'jnujaipur.ac.in', 'www.jnujaipur.ac.in',
      // New additions
      'gov.in', 'www.gov.in', 'nih.gov', 'www.nih.gov',
      'who.int', 'www.who.int', 'cdc.gov', 'www.cdc.gov',
      'harvard.edu', 'www.harvard.edu', 'stanford.edu', 'www.stanford.edu',
      'mit.edu', 'www.mit.edu', 'nasa.gov', 'www.nasa.gov',
      'ebay.com', 'www.ebay.com', 'paypal.com', 'www.paypal.com',
      'forbes.com', 'www.forbes.com', 'reuters.com', 'www.reuters.com'
    ];

    // Expanded keywords list with new terms
    const keywords = [
      // Illicit Drugs
      "cocaine", "heroin", "meth", "methamphetamine", "crystal meth", "mdma",
      "molly", "ecstasy", "lsd", "acid", "shrooms", "magic mushrooms",
      "psilocybin", "dmt", "ketamine", "special k", "ghb", "gbl", "pcp",
      "angel dust", "crack", "crack cocaine", "opium", "fentanyl", "flakka",
      "bath salts", "spice", "k2",
      // New Illicit Drugs
      "carfentanil", "kratom", "salvia", "ayahuasca", "ibogaine", "mescaline",
      // Prescription Drugs
      "xanax", "alprazolam", "bars", "footballs", "oxycontin", "oxycodone",
      "percocet", "hydrocodone", "vicodin", "tramadol", "codeine", "lean",
      "purple drank", "adderall", "dextroamphetamine", "ritalin",
      "methylphenidate", "valium", "diazepam", "ativan", "clonazepam",
      "klonopin", "soma", "zanaflex",
      // New Prescription Drugs
      "lorazepam", "ambien", "zolpidem", "suboxone", "buprenorphine", "methadone",
      // Street Names / Slang
      "blow", "coke", "snow", "flake", "yayo", "smack", "dope", "junk",
      "brown sugar", "china white", "skag", "tar", "crank", "ice", "glass",
      "tina", "rolls", "tabs", "lucy", "lucifer", "boomers", "caps",
      "liberty caps", "chronic", "weed", "pot", "bud", "herb", "ganja",
      "mary jane", "reefer", "dank", "mids", "regs", "loud", "zaza", "kush",
      "haze", "yayo dust", "booger sugar", "fire", "pookie", "zoinked",
      // New Slang
      "gas", "loudpack", "skunk", "sticky", "dro", "green", "hash",
      // Marijuana Strains
      "black mamba strain", "agent orange marijuana strain", "gary payton marijuana strain",
      "durban poison strain", "strawberry cough marijuana strain", "kyle sweet island strain",
      "5 alive marijuana strain", "do-si-dos marijuana strain", "cake bomb marijuana strain",
      "glookies marijuana strain", "space runtz marijuana strain", "skilatti strain",
      "pink certz marijuana strain", "giraffe puzzy strain",
      // New Strains
      "blue dream", "og kush", "sour diesel", "white widow", "gorilla glue",
      // Edibles and Products
      "vegan mushroom", "punch bar cream edibles", "punch bar combo",
      "polka dot magic belgian chocolate bars", "milk magic mushroom chocolate bars",
      "cookies and cream", "assorted 20 pack chocolate bars", "lemon tree dankwoods",
      "sour diesel dankwoods", "skywalker og dankwoods", "backwoods honey bourbon",
      "russian cream backwoods", "backwoods honey berry", "backwoods dark stout",
      // New Edibles
      "thc gummies", "cannabis edibles", "delta-8 vape", "delta-9 tincture",
      // Synthetic / Designer Drugs
      "2c-b", "2c-i", "2c-e", "nbome", "mxe", "etizolam", "flualprazolam",
      "clonazolam", "mephedrone", "mdpv", "alpha-pvp", "bk-mdma", "bk-2cb",
      "4-mec", "am-2201", "jwh-018", "jwh-073", "pentylone", "eutylone",
      "hexen", "isopropylphenidate", "5-meo-dmt",
      // New Synthetics
      "u-47700", "ah-7921", "mt-45", "3-mmc", "4f-mph",
      // Dark Web Terminology
      "darknet", "darkweb", "onion", "tor", "silk road", "alphabay",
      "dream market", "empire market", "hydra market", "vendor", "buyer",
      "plug", "connect", "stealth shipping", "escrow", "reship", "trip report",
      "lab tested", "clean sample", "purity", "crypto", "bitcoin", "monero",
      "altcoin", "burner phone",
      // New Dark Web Terms
      "deepweb", "marketplace", "pgp", "opsec", "drop address",
      // Quantities / Measurements
      "baggie", "dime", "dub", "eighth", "quarter", "zip", "oz", "gram",
      "key", "brick", "slab", "ounce", "bar", "pill", "tab", "blotter",
      "gel tab", "rock", "point", "point one", "rig", "rail", "bump", "hit",
      "line", "shot", "cap", "spoon",
      // New Quantities
      "kilo", "pound", "qp", "hp", "lid",
      // Usage Terms
      "snort", "sniff", "hit", "shoot", "inject", "iv", "im", "bump", "toke",
      "smoke", "bake", "roll", "plug", "boof", "slam", "trip", "dose",
      "microdose", "candyflip", "hippieflip", "nod", "nodding", "buzz", "high",
      "faded", "twisted", "zooted", "blasted", "geeked", "lit", "tripping",
      "rolling", "spun",
      // New Usage Terms
      "chief", "blaze", "vibe", "stoned", "ripped",
      // Preparation / Distribution
      "cut", "stepped on", "laced", "cook", "freebase", "base", "shake and bake",
      "crush", "dissolve", "break down", "stash", "stash spot", "re-up",
      "bag up", "cap up", "serve", "push", "trap", "traphouse", "cookhouse",
      "hot plate", "spoon", "lighter", "foil", "rig", "needle", "tourniquet",
      // New Distribution Terms
      "deal", "move", "flip", "hustle", "sling",
      // Paraphernalia
      "bong", "pipe", "bowl", "rig", "dab rig", "torch", "lighter", "foil",
      "needle", "syringe", "spoon", "cotton", "belt", "tourniquet",
      "roach clip", "papers", "wrap", "blunt", "joint", "spliff", "vape", "dab",
      "wax", "oil", "shatter", "crumble",
      // New Paraphernalia
      "vaporizer", "cart", "pen", "chillum", "one-hitter",
      // Obfuscated / Coded
      "x@n@x", "w33d", "m3th", "h3r0in", "5hro0ms", "l$D", "m@riju@na",
      "r1talin", "dr@nk", "dr@g", "0xy", "ad3rall", "b3nz0s", "p3rcs",
      "f3nt", "p!lls", "b@rs", "j$oint", "sn!ff", "sh00t",
      // New Obfuscated Terms
      "c0k3", "h3r0", "m3ff", "0p1um", "k3t"
    ];

    // Dark Mode Toggle
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    const setTheme = (theme) => {
      body.className = `min-h-screen ${theme}-mode`;
      themeToggle.innerHTML = `<i class="fas ${theme === 'dark' ? 'fa-sun' : 'fa-moon'}"></i>`;
      localStorage.setItem('theme', theme);
    };
    themeToggle.addEventListener('click', () => {
      const currentTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
      setTheme(currentTheme);
    });
    // Initialize theme from local storage
    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme);

    // Function to extract domain from URL
    function extractDomain(url) {
      try {
        let domain = new URL(url).hostname;
        domain = domain.replace(/^www\./, '');
        return domain.toLowerCase();
      } catch (e) {
        return null;
      }
    }

    // Function to create a progress ring SVG
    function createProgressRing(radius, progress, color) {
      const circumference = 2 * Math.PI * radius;
      const strokeDashoffset = circumference - (progress / 100) * circumference;
      return `<svg class="w-24 h-24"><circle class="text-gray-200 dark:text-gray-600" stroke-width="10" stroke="currentColor" fill="transparent" r="${radius}" cx="50%" cy="50%"/><circle class="progress-ring__circle ${color}" stroke-width="10" stroke-dasharray="${circumference}" stroke-dashoffset="${strokeDashoffset}" stroke-linecap="round" stroke="currentColor" fill="transparent" r="${radius}" cx="50%" cy="50%"/><text x="50%" y="50%" text-anchor="middle" dy=".3em" class="text-lg font-bold ${color.replace('text-', 'fill-')}">${progress}%</text></svg>`;
    }

    // Function to create a fixed height bar chart for top 20 terms
    function createTermFrequencyChart(termFrequency) {
      const sortedTerms = Object.entries(termFrequency).sort((a, b) => b[1] - a[1]).slice(0, 20);
      const labels = sortedTerms.map(item => item[0]);
      const data = sortedTerms.map(item => item[1]);
      const maxValue = Math.max(...data);
      const scalingFactor = 400 / maxValue;
      const scaledData = data.map(value => Math.round(value * scalingFactor));
      const backgroundColors = labels.map(term => {
        if (term.includes('weed') || term.includes('marijuana') || term.includes('kush')) {
          return 'rgba(22, 163, 74, 0.7)';
        } else if (term.includes('cocaine') || term.includes('coke') || term.includes('crack')) {
          return 'rgba(220, 38, 38, 0.7)';
        } else if (term.includes('heroin') || term.includes('opium') || term.includes('fentanyl')) {
          return 'rgba(37, 99, 235, 0.7)';
        } else if (term.includes('xanax') || term.includes('valium') || term.includes('klonopin')) {
          return 'rgba(234, 179, 8, 0.7)';
        } else if (term.includes('lsd') || term.includes('shrooms') || term.includes('dmt')) {
          return 'rgba(139, 92, 246, 0.7)';
        } else {
          return 'rgba(20, 184, 166, 0.7)';
        }
      });
      const canvas = document.createElement('canvas');
      canvas.className = 'fixed-chart-container';
      const container = document.createElement('div');
      container.className = 'mt-5 bg-white/50 dark:bg-gray-800/50 p-3 rounded-lg';
      container.innerHTML = `<h3 class="text-base font-semibold mb-2 text-center text-gray-700 dark:text-gray-200"><i class="fas fa-chart-bar mr-2 text-green-500"></i> Top 20 Drug Terms Detected</h3>`;
      container.appendChild(canvas);
      setTimeout(() => {
        const ctx = canvas.getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Mentions',
              data: scaledData,
              backgroundColor: backgroundColors,
              borderColor: backgroundColors.map(color => color.replace('0.7', '1')),
              borderWidth: 1,
              borderRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y',
            scales: {
              x: {
                beginAtZero: true,
                max: 400,
                ticks: {
                  precision: 0,
                  callback: function(value) { return Math.round(value / scalingFactor); }
                },
                grid: { display: false }
              },
              y: {
                grid: { display: false },
                ticks: { autoSkip: false, font: { size: 10 } }
              }
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function(context) { return `Mentions: ${data[context.dataIndex]}`; }
                }
              }
            }
          }
        });
      }, 100);
      return container;
    }

    // Enhanced metadata extraction
    function extractMetadata(html) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const metaTags = Array.from(doc.querySelectorAll('meta')).reduce((acc, tag) => {
        const name = tag.getAttribute('name') || tag.getAttribute('property') || tag.getAttribute('itemprop');
        if (name) acc[name.toLowerCase()] = tag.getAttribute('content');
        return acc;
      }, {});
      const title = doc.querySelector('title')?.textContent || 'No title found';
      const emailRegex = /([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi;
      const emails = Array.from(new Set(html.match(emailRegex) || []));
      const phoneRegex = /(\+\d{1,3}[- ]?)?(\(\d{3}\)|\d{3})[- ]?\d{3}[- ]?\d{4}/g;
      const phones = Array.from(new Set(html.match(phoneRegex) || []));
      const addressRegex = /\d{1,5}\s\w+\s\w+(?:\s\w+)?,\s\w{2,}\s\d{5}(-\d{4})?/g;
      const addresses = Array.from(new Set(html.match(addressRegex) || []));
      const links = Array.from(doc.querySelectorAll('a')).map(a => a.href);
      // Additional metadata
      const author = metaTags['author'] || 'Unknown';
      const robots = metaTags['robots'] || 'Not specified';
      const favicon = doc.querySelector('link[rel*="icon"]')?.href || 'None';
      const socialLinks = links.filter(link =>
        link.includes('facebook.com') || link.includes('twitter.com') ||
        link.includes('instagram.com') || link.includes('linkedin.com') ||
        link.includes('t.me') || link.includes('discord.com')
      );
      return { title, metaTags, emails, phones, addresses, links, author, robots, favicon, socialLinks };
    }

    // Fetch IP and location data
    async function fetchIpData(domain) {
      try {
        const ipResponse = await fetch(`https://dns.google/resolve?name=${domain}&type=A`);
        const ipData = await ipResponse.json();
        if (!ipData.Answer || ipData.Answer.length === 0) {
          return { error: "Could not resolve IP address" };
        }
        const ip = ipData.Answer[0].data;
        const locationResponse = await fetch(`https://ipapi.co/${ip}/json/`);
        const locationData = await locationResponse.json();
        return { ip, locationData };
      } catch (error) {
        console.error("Error fetching IP data:", error);
        return { error: "Could not fetch location data" };
      }
    }

    // Advanced threat indicators
    function calculateAdvancedThreatScore(termFrequency) {
      const categories = {
        illicit: 0,
        prescription: 0,
        slang: 0,
        strains: 0,
        edibles: 0,
        synthetics: 0,
        darkweb: 0,
        quantities: 0,
        usage: 0,
        distribution: 0,
        paraphernalia: 0,
        obfuscated: 0
      };
      const weights = {
        illicit: 2.5,
        prescription: 1.5,
        slang: 1.0,
        strains: 1.2,
        edibles: 1.3,
        synthetics: 2.0,
        darkweb: 3.0,
        quantities: 1.5,
        usage: 1.2,
        distribution: 2.0,
        paraphernalia: 1.8,
        obfuscated: 2.2
      };
      Object.keys(termFrequency).forEach(term => {
        if (term.includes('cocaine') || term.includes('heroin') || term.includes('meth') || term.includes('fentanyl')) {
          categories.illicit += termFrequency[term];
        } else if (term.includes('xanax') || term.includes('oxycontin') || term.includes('adderall')) {
          categories.prescription += termFrequency[term];
        } else if (term.includes('blow') || term.includes('coke') || term.includes('weed')) {
          categories.slang += termFrequency[term];
        } else if (term.includes('strain')) {
          categories.strains += termFrequency[term];
        } else if (term.includes('edibles') || term.includes('chocolate') || term.includes('gummies')) {
          categories.edibles += termFrequency[term];
        } else if (term.includes('2c-b') || term.includes('nbome') || term.includes('mxe')) {
          categories.synthetics += termFrequency[term];
        } else if (term.includes('darknet') || term.includes('tor') || term.includes('bitcoin')) {
          categories.darkweb += termFrequency[term];
        } else if (term.includes('gram') || term.includes('ounce') || term.includes('zip')) {
          categories.quantities += termFrequency[term];
        } else if (term.includes('snort') || term.includes('inject') || term.includes('smoke')) {
          categories.usage += termFrequency[term];
        } else if (term.includes('cut') || term.includes('trap') || term.includes('deal')) {
          categories.distribution += termFrequency[term];
        } else if (term.includes('bong') || term.includes('pipe') || term.includes('vape')) {
          categories.paraphernalia += termFrequency[term];
        } else if (term.includes('@') || term.includes('$') || term.includes('!')) {
          categories.obfuscated += termFrequency[term];
        }
      });
      let totalScore = 0;
      Object.keys(categories).forEach(category => {
        totalScore += categories[category] * weights[category];
      });
      return { score: Math.min(100, Math.round(totalScore)), categories };
    }

    // Create website details section with enhanced metadata
    async function createWebsiteDetails(url, html) {
      let domain = extractDomain(url);
      const metadata = extractMetadata(html);
      const ipData = await fetchIpData(domain);
      const detailsDiv = document.createElement('div');
      detailsDiv.className = 'mt-8 bg-white/80 dark:bg-gray-800/80 p-5 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700';
      detailsDiv.innerHTML = `
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center"><i class="fas fa-info-circle text-green-500 mr-2"></i> Website Intelligence Report</h3>
          <button id="exportReport" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm flex items-center">
            <i class="fas fa-download mr-2"></i> Export Report
          </button>
        </div>
        <div class="info-grid">
          <!-- Domain Information -->
          <div class="info-card bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 class="font-medium text-gray-700 dark:text-gray-200 mb-3 flex items-center"><i class="fas fa-globe text-blue-500 mr-2"></i> Domain Details</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Domain:</span><span class="font-medium text-gray-700 dark:text-gray-200">${domain}</span></div>
              <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Title:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.title}</span></div>
              ${metadata.metaTags.description ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Description:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.metaTags.description.substring(0, 50)}...</span></div>` : ''}
              ${metadata.metaTags.keywords ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Keywords:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.metaTags.keywords.substring(0, 50)}...</span></div>` : ''}
              <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Author:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.author}</span></div>
              <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Robots:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.robots}</span></div>
              <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Favicon:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.favicon}</span></div>
            </div>
          </div>
          <!-- Hosting Information -->
          <div class="info-card bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 class="font-medium text-gray-700 dark:text-gray-200 mb-3 flex items-center"><i class="fas fa-server text-purple-500 mr-2"></i> Hosting Details</h4>
            <div class="space-y-2 text-sm">
              ${ipData.ip ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">IP Address:</span><div class="flex items-center"><span class="font-medium text-gray-700 dark:text-gray-200 mr-2">${ipData.ip}</span><button class="copy-btn p-1 rounded-full text-gray-400 hover:text-gray-600 dark:hover:text-gray-200" onclick="copyToClipboard('${ipData.ip}')"><i class="fas fa-copy text-xs"></i></button></div></div>` : ''}
              ${ipData.locationData?.org ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">ISP:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.org}</span></div>` : ''}
              ${ipData.locationData?.city && ipData.locationData?.country_name ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Location:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.city}, ${ipData.locationData.country_name}</span></div>` : ''}
              ${metadata.metaTags['generator'] ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Generator:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.metaTags['generator']}</span></div>` : ''}
            </div>
          </div>
          <!-- SSL Information -->
          <div class="info-card bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 class="font-medium text-gray-700 dark:text-gray-200 mb-3 flex items-center"><i class="fas fa-lock text-green-500 mr-2"></i> Security Details</h4>
            <div class="space-y-2 text-sm">
              ${url.startsWith('https') ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Protocol:</span><span class="font-medium text-green-600">HTTPS (Secure)</span></div>` : `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Protocol:</span><span class="font-medium text-red-600">HTTP (Not Secure)</span></div>`}
              ${metadata.metaTags['og:type'] ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Content Type:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.metaTags['og:type']}</span></div>` : ''}
              ${metadata.metaTags['og:site_name'] ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Site Name:</span><span class="font-medium text-gray-700 dark:text-gray-200">${metadata.metaTags['og:site_name']}</span></div>` : ''}
            </div>
          </div>
          <!-- Contact Information -->
          <div class="info-card bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 class="font-medium text-gray-700 dark:text-gray-200 mb-3 flex items-center"><i class="fas fa-envelope text-orange-500 mr-2"></i> Contact Info</h4>
            <div class="space-y-2 text-sm">
              ${metadata.emails.length > 0 ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Emails:</span><div class="text-right">${metadata.emails.slice(0, 2).map(email => `<div class="flex items-center justify-end"><span class="font-medium text-gray-700 dark:text-gray-200 mr-2">${email}</span><button class="copy-btn p-1 rounded-full text-gray-400 hover:text-gray-600 dark:hover:text-gray-200" onclick="copyToClipboard('${email}')"><i class="fas fa-copy text-xs"></i></button></div>`).join('')}${metadata.emails.length > 2 ? `<div class="text-xs text-gray-500 dark:text-gray-400">+${metadata.emails.length - 2} more</div>` : ''}</div></div>` : `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Emails:</span><span class="font-medium text-gray-700 dark:text-gray-200">None found</span></div>`}
              ${metadata.phones.length > 0 ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Phones:</span><div class="text-right">${metadata.phones.slice(0, 2).map(phone => `<div class="flex items-center justify-end"><span class="font-medium text-gray-700 dark:text-gray-200 mr-2">${phone}</span><button class="copy-btn p-1 rounded-full text-gray-400 hover:text-gray-600 dark:hover:text-gray-200" onclick="copyToClipboard('${phone}')"><i class="fas fa-copy text-xs"></i></button></div>`).join('')}${metadata.phones.length > 2 ? `<div class="text-xs text-gray-500 dark:text-gray-400">+${metadata.phones.length - 2} more</div>` : ''}</div></div>` : `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Phones:</span><span class="font-medium text-gray-700 dark:text-gray-200">None found</span></div>`}
              ${metadata.addresses.length > 0 ? `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Addresses:</span><div class="text-right">${metadata.addresses.slice(0, 1).map(address => `<div class="flex items-center justify-end"><span class="font-medium text-gray-700 dark:text-gray-200 mr-2">${address}</span><button class="copy-btn p-1 rounded-full text-gray-400 hover:text-gray-600 dark:hover:text-gray-200" onclick="copyToClipboard('${address}')"><i class="fas fa-copy text-xs"></i></button></div>`).join('')}${metadata.addresses.length > 1 ? `<div class="text-xs text-gray-500 dark:text-gray-400">+${metadata.addresses.length - 1} more</div>` : ''}</div></div>` : `<div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Addresses:</span><span class="font-medium text-gray-700 dark:text-gray-200">None found</span></div>`}
            </div>
          </div>
          <!-- Server Location -->
          <div class="info-card bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 class="font-medium text-gray-700 dark:text-gray-200 mb-3 flex items-center"><i class="fas fa-map-marker-alt text-red-500 mr-2"></i> Server Location</h4>
            <div class="space-y-2 text-sm">
              ${ipData.locationData ? `
                <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Country:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.country_name} (${ipData.locationData.country})</span></div>
                <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Region:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.region}</span></div>
                <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">City:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.city}</span></div>
                <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Postal Code:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.postal}</span></div>
                <div class="flex justify-between"><span class="text-gray-500 dark:text-gray-400">Timezone:</span><span class="font-medium text-gray-700 dark:text-gray-200">${ipData.locationData.timezone}</span></div>
              ` : `<div class="text-center text-gray-500 dark:text-gray-400 py-2"><i class="fas fa-exclamation-circle mr-1"></i> Location data not available</div>`}
            </div>
          </div>
          <!-- Social Media -->
          <div class="info-card bg-white dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 class="font-medium text-gray-700 dark:text-gray-200 mb-3 flex items-center"><i class="fas fa-share-alt text-pink-500 mr-2"></i> Social Links</h4>
            <div class="flex flex-wrap gap-3 mt-2">
              ${metadata.socialLinks.length > 0 ? metadata.socialLinks.slice(0, 4).map(link => `<a href="${link}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm"><i class="fab ${link.includes('facebook.com') ? 'fa-facebook' : link.includes('twitter.com') ? 'fa-twitter' : link.includes('instagram.com') ? 'fa-instagram' : link.includes('linkedin.com') ? 'fa-linkedin' : link.includes('t.me') ? 'fa-telegram' : 'fa-discord'} mr-1"></i>${new URL(link).hostname}</a>`).join('') : `<div class="text-gray-500 dark:text-gray-400 text-sm">No social links found</div>`}
            </div>
          </div>
        </div>
        <div class="mt-5 text-xs text-gray-500 dark:text-gray-400">
          <p><i class="fas fa-exclamation-triangle text-yellow-500 mr-1"></i> Some information may be redacted for privacy or unavailable due to protection services.</p>
        </div>`;
      // Add export functionality
      detailsDiv.querySelector('#exportReport').addEventListener('click', () => {
        const report = {
          url,
          domain,
          metadata,
          ipData,
          timestamp: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `narcwatch_report_${domain}_${Date.now()}.json`;
        link.click();
      });
      return detailsDiv;
    }

    // Function to copy text to clipboard
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg text-sm animate-bounce';
        toast.textContent = 'Copied to clipboard!';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);
      }).catch(err => console.error('Failed to copy text: ', err));
    }

    // Historical scan management
    function saveScanToHistory(url, result) {
      const history = JSON.parse(localStorage.getItem('narcwatchHistory') || '[]');
      history.unshift({
        url,
        timestamp: new Date().toISOString(),
        result: result.innerHTML
      });
      if (history.length > 10) history.pop(); // Limit to 10 scans
      localStorage.setItem('narcwatchHistory', JSON.stringify(history));
      displayHistory();
    }

    function displayHistory() {
      const historySection = document.getElementById('historySection');
      const historyList = document.getElementById('historyList');
      const history = JSON.parse(localStorage.getItem('narcwatchHistory') || '[]');
      if (history.length === 0) {
        historySection.classList.add('hidden');
        return;
      }
      historySection.classList.remove('hidden');
      historyList.innerHTML = history.map((scan, index) => `
        <div class="bg-white/80 dark:bg-gray-800/80 p-4 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm font-medium text-gray-700 dark:text-gray-200">${scan.url}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">${new Date(scan.timestamp).toLocaleString()}</p>
            </div>
            <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200" onclick="showHistoricalScan(${index})"><i class="fas fa-eye"></i></button>
          </div>
        </div>
      `).join('');
    }

    function showHistoricalScan(index) {
      const history = JSON.parse(localStorage.getItem('narcwatchHistory') || '[]');
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = history[index].result;
    }

    // Initialize history display
    displayHistory();

    // Form submission handler
    document.getElementById('checkForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const url = document.getElementById('urlInput').value;
      const resultDiv = document.getElementById('result');
      const defaultMessage = document.getElementById('defaultMessage');
      if (defaultMessage) defaultMessage.remove();

      // Check domain whitelist
      const domain = extractDomain(url);
      if (domain && trustedDomains.includes(domain)) {
        resultDiv.innerHTML = `
          <div class="space-y-5 fade-in" style="animation-delay: 0.2s;">
            <div class="bg-white/80 dark:bg-gray-800/80 p-5 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
              <div class="flex flex-col items-center">
                <h3 class="text-lg font-semibold text-center mb-2 text-gray-700 dark:text-gray-200">Trusted Domain Verification</h3>
                ${createProgressRing(30, 0, "text-blue-500")}
                <div class="mt-3 px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900">
                  <p class="text-xs font-medium text-blue-700 dark:text-blue-300"><i class="fas fa-check-circle mr-1"></i> Trusted Site</p>
                </div>
              </div>
            </div>
            <div class="w-full bg-blue-50 dark:bg-blue-900 border-l-4 border-blue-500 p-4 rounded-lg">
              <div class="flex">
                <div class="flex-shrink-0"><i class="fas fa-shield-alt text-blue-500 text-xl mt-1"></i></div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">Verified Trusted Domain</h3>
                  <div class="mt-1 text-sm text-blue-700 dark:text-blue-300">
                    <p>${domain} is in our trusted domains whitelist.</p>
                    <p class="mt-1">This domain is verified as legitimate with very low risk of drug-related content.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="text-center mt-4">
              <div class="inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-4 py-2 rounded-full text-sm font-medium trusted-badge">
                <i class="fas fa-check-circle mr-1"></i> Whitelisted Domain
              </div>
            </div>
          </div>`;
        saveScanToHistory(url, resultDiv);
        return;
      }

      // Animate loading state
      resultDiv.innerHTML = `
        <div class="text-center py-10 pulse-animation">
          <div class="inline-block p-4 bg-green-50 dark:bg-green-900 rounded-full mb-3">
            <i class="fas fa-spinner fa-spin text-2xl text-green-500 dark:text-green-400"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-700 dark:text-gray-200 mb-2">Scanning Website Content</h3>
          <div class="w-full bg-green-50 dark:bg-green-900 rounded-full h-2 max-w-md mx-auto">
            <div class="bg-green-500 h-2 rounded-full animate-pulse" style="width: 45%"></div>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">Analyzing against ${keywords.length} drug-related terms and gathering website intelligence...</p>
        </div>`;

      // Simulate API call with timeout
      setTimeout(async () => {
        try {
          const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
          if (!response.ok) throw new Error("Could not fetch URL content");
          const html = await response.text();
          const text = html.toLowerCase();
          const termFrequency = {};
          keywords.forEach(keyword => {
            const regex = new RegExp(keyword, 'gi');
            const matches = text.match(regex);
            if (matches) termFrequency[keyword] = matches.length;
          });
          const matches = Object.keys(termFrequency);
          const keywordCount = matches.length;
          const maxKeywords = keywords.length;
          const { score: probabilityScore, categories } = calculateAdvancedThreatScore(termFrequency);

          let ringColor = "text-green-500";
          let severity = "Low probability";
          let severityColor = "text-green-500";
          let severityIcon = "fa-check-circle";
          if (probabilityScore > 30) {
            ringColor = "text-yellow-500";
            severity = "Moderate probability";
            severityColor = "text-yellow-600";
            severityIcon = "fa-exclamation-triangle";
          }
          if (probabilityScore > 60) {
            ringColor = "text-orange-500";
            severity = "High probability";
            severityColor = "text-orange-600";
            severityIcon = "fa-exclamation-circle";
          }
          if (probabilityScore > 80) {
            ringColor = "text-red-500";
            severity = "Very high probability";
            severityColor = "text-red-600";
            severityIcon = "fa-radiation";
          }

          if (matches.length > 0) {
            resultDiv.innerHTML = `
              <div class="space-y-5">
                <!-- Score Card -->
                <div class="bg-white/80 dark:bg-gray-800/80 p-5 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
                  <div class="flex flex-col items-center">
                    <h3 class="text-lg font-semibold text-center mb-2 text-gray-700 dark:text-gray-200">Drug Content Probability</h3>
                    ${createProgressRing(30, probabilityScore, ringColor)}
                    <div class="mt-3 px-3 py-1 rounded-full bg-${severityColor.replace('text-', '')}/10">
                      <p class="text-xs font-medium ${severityColor}"><i class="fas ${severityIcon} mr-1"></i> ${severity}</p>
                    </div>
                  </div>
                </div>
                <!-- Warning Alert -->
                <div class="bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900 dark:to-red-800 border-l-4 border-red-500 p-3 rounded-lg">
                  <div class="flex">
                    <div class="flex-shrink-0"><i class="fas ${severityIcon} text-red-500 text-lg mt-1"></i></div>
                    <div class="ml-3">
                      <h3 class="text-xs font-medium text-red-800 dark:text-red-200">Potential Drug Content Detected</h3>
                      <div class="mt-1 text-xs text-red-700 dark:text-red-300">
                        <p>${keywordCount} drug-related terms were found (${Math.round((keywordCount/maxKeywords)*100)}% of our monitored terms).</p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Advanced Threat Indicators -->
                <div class="bg-white/80 dark:bg-gray-800/80 p-3 rounded-lg shadow-sm">
                  <h4 class="font-semibold text-gray-700 dark:text-gray-200 text-base mb-2 flex items-center"><i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i> Threat Category Analysis</h4>
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    ${Object.entries(categories).map(([category, count]) => `
                      <div class="flex justify-between p-2 bg-gray-50 dark:bg-gray-900 rounded-lg">
                        <span class="text-gray-500 dark:text-gray-400 capitalize">${category}:</span>
                        <span class="font-medium text-gray-700 dark:text-gray-200">${count} mentions</span>
                      </div>
                    `).join('')}
                  </div>
                </div>
                <!-- Keywords Card -->
                <div class="bg-white/80 dark:bg-gray-800/80 p-3 rounded-lg shadow-sm">
                  <h4 class="font-semibold text-gray-700 dark:text-gray-200 text-base mb-2 flex items-center"><i class="fas fa-tags text-green-500 mr-2"></i> Detected Keywords</h4>
                  <div class="flex flex-wrap gap-2 p-1 keyword-scroll" style="max-height: 200px; overflow-y: auto;">
                    ${matches.map(word => `<span class="keyword-badge bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 px-2 py-1 rounded-full border border-gray-200 dark:border-gray-700 text-xs shadow-sm">${word} <span class="font-bold ml-1">(${termFrequency[word]})</span></span>`).join('')}
                  </div>
                </div>
              </div>`;
            resultDiv.appendChild(createTermFrequencyChart(termFrequency));
            const topTerms = Object.entries(termFrequency).sort((a, b) => b[1] - a[1]).slice(0, 3);
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'bg-green-50/50 dark:bg-green-900/50 p-3 rounded-lg border-l-4 border-green-500 mt-5';
            summaryDiv.innerHTML = `
              <div class="flex">
                <div class="flex-shrink-0"><i class="fas fa-chart-pie text-green-500 text-lg mt-1"></i></div>
                <div class="ml-3">
                  <h3 class="text-xs font-medium text-green-800 dark:text-green-200">Content Analysis Summary</h3>
                  <div class="mt-1 text-xs text-green-700 dark:text-green-300">
                    <p>Most mentioned term: <span class="font-bold">${topTerms[0][0]}</span> (${topTerms[0][1]} mentions)</p>
                    ${topTerms[0][1] > 5 ? `<p class="mt-1">This suggests potential availability or discussion of ${topTerms[0][0]} on this site.</p>` : ''}
                  </div>
                </div>
              </div>`;
            resultDiv.appendChild(summaryDiv);
            const websiteDetails = await createWebsiteDetails(url, html);
            resultDiv.appendChild(websiteDetails);
          } else {
            resultDiv.innerHTML = `
              <div class="space-y-5">
                <div class="bg-white/80 dark:bg-gray-800/80 p-5 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
                  <div class="flex flex-col items-center">
                    <h3 class="text-lg font-semibold text-center mb-2 text-gray-700 dark:text-gray-200">Drug Content Probability</h3>
                    ${createProgressRing(30, probabilityScore, "text-green-500")}
                    <div class="mt-3 px-3 py-1 rounded-full bg-green-100 dark:bg-green-900">
                      <p class="text-xs font-medium text-green-700 dark:text-green-300"><i class="fas fa-check-circle mr-1"></i> Very low probability</p>
                    </div>
                  </div>
                </div>
                <div class="bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900 dark:to-green-800 border-l-4 border-green-500 p-3 rounded-lg">
                  <div class="flex">
                    <div class="flex-shrink-0"><i class="fas fa-check-circle text-green-500 text-lg mt-1"></i></div>
                    <div class="ml-3">
                      <h3 class="text-xs font-medium text-green-800 dark:text-green-200">No Drug Content Detected</h3>
                      <div class="mt-1 text-xs text-green-700 dark:text-green-300">
                        <p>No drug-related keywords were found on this page.</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>`;
            const websiteDetails = await createWebsiteDetails(url, html);
            resultDiv.appendChild(websiteDetails);
          }
          saveScanToHistory(url, resultDiv);
        } catch (err) {
          resultDiv.innerHTML = `
            <div class="bg-yellow-50 dark:bg-yellow-900 border-l-4 border-yellow-500 p-3 rounded-lg">
              <div class="flex">
                <div class="flex-shrink-0"><i class="fas fa-exclamation-triangle text-yellow-500 text-lg mt-1"></i></div>
                <div class="ml-3">
                  <h3 class="text-xs font-medium text-yellow-800 dark:text-yellow-200">Analysis Error</h3>
                  <div class="mt-1 text-xs text-yellow-700 dark:text-yellow-300">
                    <p>${err.message}</p>
                    <p class="mt-1">This might be due to CORS restrictions or the site not being accessible.</p>
                  </div>
                </div>
              </div>
            </div>`;
        }
      }, 1500);
    });
  </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
